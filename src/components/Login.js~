import React from "react";
import {baseUrl} from "../constants";
import axios from "axios";
import FormData from "form-data";
function Login() {
    const [username, setUsername] = React.useState("");
    const [password, setPassword] = React.useState("");
    const [message, setMessage] = React.useState("");

    function usernameChangeHandler(event) {
        setUsername(event.target.value);
    }

    function passwordChangeHandler(event) {
        setPassword(event.target.value);
    }

    function login() {
        if (username === "" || password === "") {

            console.log("Login eror fields missing");
        } else {
            const FormData = require('form-data');
            let data = new FormData();
            data.append('password', password);
            data.append('username', username);

            let config = {
                method: 'post',
                maxBodyLength: Infinity,
                url: baseUrl + '/users/login/',
                headers: {
                    ...data.getHeaders()
                },
                data: data
            };

            axios.request(config)
                .then((response) => {
                    console.log(JSON.stringify(response.data));
                    localStorage.setItem("Token", response.data.token);
                    setMessage("Login successful");
                })
                .catch((error) => {
                    console.log(error);

                    setMessage("Login error");
                });

        }
    }

    return (
        <div>
            <h1>LOGIN</h1>
            <p>Username: <input type="text" onChange={usernameChangeHandler} /></p>
            <p>Password: <input type="password" onChange={passwordChangeHandler} /></p>
            <p><button onClick={login}>Login</button>{message}</p>
        </div>
    );
}

export default Login